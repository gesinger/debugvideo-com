"use strict";(self.webpackChunkdebug_video=self.webpackChunkdebug_video||[]).push([[683],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),h=u(n),d=a,f=h["".concat(l,".").concat(d)]||h[d]||p[d]||o;return n?r.createElement(f,i(i({ref:t},c),{},{components:n})):r.createElement(f,i({ref:t},c))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},9297:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return c},default:function(){return h}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],s={},l="What if you can't reproduce?",u={unversionedId:"what-if-you-cant-reproduce",id:"what-if-you-cant-reproduce",title:"What if you can't reproduce?",description:"If you can't reproduce the issue, or you're struggling to reproduce it, then there are some strategies you can take to try to gather information on what might've happened. In addition, if you are able to do a little preliminary debugging using this info, it will help to create the exact conditions necessary to reproduce the issue.",source:"@site/docs/what-if-you-cant-reproduce.md",sourceDirName:".",slug:"/what-if-you-cant-reproduce",permalink:"/what-if-you-cant-reproduce",tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"Adressing new tickets",permalink:"/addressing-new-tickets"},next:{title:"Browser developer tools",permalink:"/browser-devtools"}},c=[{value:"HAR",id:"har",children:[],level:2},{value:"Forceful reproduction",id:"forceful-reproduction",children:[{value:"Proxying",id:"proxying",children:[],level:3},{value:"Writing scripts",id:"writing-scripts",children:[{value:"Seek until stuck in seeking",id:"seek-until-stuck-in-seeking",children:[],level:4},{value:"Pause and log when there&#39;s a gap in the buffer",id:"pause-and-log-when-theres-a-gap-in-the-buffer",children:[],level:4}],level:3}],level:2}],p={toc:c};function h(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"what-if-you-cant-reproduce"},"What if you can't reproduce?"),(0,o.kt)("p",null,"If you can't reproduce the issue, or you're struggling to reproduce it, then there are some strategies you can take to try to gather information on what might've happened. In addition, if you are able to do a little preliminary debugging using this info, it will help to create the exact conditions necessary to reproduce the issue."),(0,o.kt)("h2",{id:"har"},"HAR"),(0,o.kt)("p",null,"To debug any stream or network related issues, a HAR (HTTP Archive) file provides as much information as the ",(0,o.kt)("a",{parentName:"p",href:"devtools-network"},"devtools network panel"),". Even better, it provides a permanent record of the web traffic that can be passed from anyone who can reproduce the issue to you."),(0,o.kt)("p",null,"Almost all browsers support saving the network traffic as a HAR file. See ",(0,o.kt)("a",{parentName:"p",href:"https://support.google.com/admanager/answer/10358597"},"this article")," for how to do it in Chrome."),(0,o.kt)("p",null,"Even without a browser that supports saving the network traffic, a HAR file may still be saved using proxy tools, such as the great ",(0,o.kt)("a",{parentName:"p",href:"https://www.charlesproxy.com/"},"Charles Proxy"),". Charles also makes HAR files easy to read."),(0,o.kt)("p",null,"To see more on what HAR files enable you to do, see this ",(0,o.kt)("a",{parentName:"p",href:"charles-and-har-files"},"section on Charles Proxy and HAR files"),"."),(0,o.kt)("h2",{id:"forceful-reproduction"},"Forceful reproduction"),(0,o.kt)("p",null,"Often, issues are easy to reproduce. But sometimes the conditions to reproduce an issue happen so rarely that hours can be spent doing monotonous tasks such as seeking or watching the same ad on repeat a hundred times in a row (even for ads you thought were entertaining the twentieth time...by the seventieth you start to rethink things)."),(0,o.kt)("p",null,"When issues are hard to reproduce, try a strategy that might save your sanity. Here are some that are often successful."),(0,o.kt)("h3",{id:"proxying"},"Proxying"),(0,o.kt)("p",null,"Charles Proxy is so useful it earned its own ",(0,o.kt)("a",{parentName:"p",href:"charles-and-har-files"},"special section along with HAR files")," to describe how it can be used to proxy in reproducing issues and testing fixes."),(0,o.kt)("h3",{id:"writing-scripts"},"Writing scripts"),(0,o.kt)("p",null,"If you're spending hours trying to reproduce an issue, let the computer do the work for you. Since just about all UI elements for a video player can be accessed programmatically, any user actions can be done via a script."),(0,o.kt)("p",null,"Here are some examples:"),(0,o.kt)("h4",{id:"seek-until-stuck-in-seeking"},"Seek until stuck in seeking"),(0,o.kt)("p",null,"Sometimes a seek never completes. In this case, the player's state will be stuck ",(0,o.kt)("inlineCode",{parentName:"p"},"seeking"),". This script will seek until the player is stuck in that state, so you can go off and do whatever you want instead of clicking the progress bar over and over."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"(() => {\n  // Here we're assuming there's one video element on the page, but\n  // it would be better to use the specific player you want in place\n  // of this assumption.\n  const videoElement = document.getElementsByTagName('video')[0];\n\n  // 5 seconds is a good place to start as a normal\n  // interval. Too short of an interval wouldn't be\n  // very normal behavior, as it might be short\n  // enough that the content wouldn't be downloaded\n  // and processed enough to play before the next\n  // seek.\n  //\n  // A more advanced script can use the player buffer\n  // and current time to check, but this quick script\n  // should handle most cases.\n  const SEEK_INTERVAL = 5000;\n  let seekCount = 1;\n  const interval = setInterval(() => {\n    // The case we're looking for.\n    if (videoElement.seeking) {\n      clearInterval(interval);\n      return;\n    }\n\n    // Sometimes a seek ends up within 5 seconds of\n    // the end of a video. If the video ends, have\n    // it automatically restart.\n    if (videoElement.ended) {\n      videoElement.play();\n    }\n\n    // Seek to somewhere within the lenght of the\n    // video. If this is a live stream, use the\n    // seekable range instead of the duration.\n    const seekTo = Math.random() * videoElement.duration;\n\n    console.log(`Seek #${seekCount} to: ${seekTo}`);\n\n    seekCount++;\n    videoElement.currentTime = seekTo;\n  }, SEEK_INTERVAL);\n})();\n")),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Try it yourself")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Open a page with a video element on it (such as ",(0,o.kt)("a",{parentName:"p",href:"https://videojs-http-streaming.netlify.app/"},"the VHS test page"),") and run the script above in your console."))),(0,o.kt)("h4",{id:"pause-and-log-when-theres-a-gap-in-the-buffer"},"Pause and log when there's a gap in the buffer"),(0,o.kt)("p",null,"Gaps in the buffer are often the cause of issues in video playback. Sometimes the player will stop, and sometimes the player will have logic to skip over gaps (in addition, the underlying browser's media player may skip small gaps)."),(0,o.kt)("p",null,"To debug gap-related issues, it's sometimes necessary to pause the player as soon as one occurs, to prevent the state of the player from changing."),(0,o.kt)("p",null,"To pause at a gap, the simple approach is to look for when the player has more than one buffered time range, since buffered should only ever have one time range when there are no gaps",(0,o.kt)("sup",{parentName:"p",id:"fnref-1"},(0,o.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1")),"."),(0,o.kt)("p",null,"As for how frequently to check, the optimal approach is to listen for a specific video player event which triggers when a video content append finishes. Alternatively, the browser's video element may trigger a ",(0,o.kt)("inlineCode",{parentName:"p"},"waiting")," event when it encounters a temporary lack of data. But another easy approach that's useful for debugging is to set an interval and hope for the best. It'll handle a good number of cases."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"(() => {\n  // Here we're assuming there's one video element on the page, but\n  // it would be better to use the specific player you want in place\n  // of this assumption.\n  const videoElement = document.getElementsByTagName('video')[0];\n\n  const timeRangesToArray = (timeRanges) => {\n    const timeRangesList = [];\n\n    for (let i = 0; i < timeRanges.length; i++) {\n      timeRangesList.push({\n        start: timeRanges.start(i),\n        end: timeRanges.end(i)\n      });\n    }\n\n    return timeRangesList;\n  };\n\n  const timeRangesString = (timeRangesArray) => {\n    let string = timeRangesArray.reduce((acc, timeRange) => {\n      acc += `${timeRange.start} => ${timeRange.end}, `;\n      return acc;\n    }, '');\n\n    return string.substring(0, string.length - 2);\n  };\n\n  // The check is pretty cheap, so running it every 100ms isn't going\n  // to degrade performance enough to alter the behavior of the player,\n  // at least during a debugging session.\n  const CHECK_INTERVAL = 100;\n  const interval = setInterval(() => {\n    const buffered = videoElement.buffered;\n\n    if (buffered.length > 1) {\n      videoElement.pause();\n      clearInterval(interval);\n      console.log('Found a gap in the buffer');\n      // Log the buffer in an easily readable way\n      console.log(timeRangesString(timeRangesToArray(buffered)));\n      return;\n    }\n  }, CHECK_INTERVAL);\n})();\n")),(0,o.kt)("div",{className:"footnotes"},(0,o.kt)("hr",{parentName:"div"}),(0,o.kt)("ol",{parentName:"div"},(0,o.kt)("li",{parentName:"ol",id:"fn-1"},"There may be more than one time range if a user seeks and the player doesn't clear the old buffer contents, but most players will clear out any buffer not in the immediate vicinity of the playhead.",(0,o.kt)("a",{parentName:"li",href:"#fnref-1",className:"footnote-backref"},"\u21a9")))))}h.isMDXComponent=!0}}]);