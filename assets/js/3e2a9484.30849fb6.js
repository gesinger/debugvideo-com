"use strict";(self.webpackChunkdebug_video=self.webpackChunkdebug_video||[]).push([[393],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return y}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(n),y=o,h=u["".concat(l,".").concat(y)]||u[y]||d[y]||a;return n?r.createElement(h,i(i({ref:t},p),{},{components:n})):r.createElement(h,i({ref:t},p))}));function y(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var c=2;c<a;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},5162:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return p},default:function(){return u}});var r=n(7462),o=n(3366),a=(n(7294),n(3905)),i=["components"],s={},l="DRM",c={unversionedId:"drm",id:"drm",title:"DRM",description:"Now it's time for everyone's favorite topic, digital rights management.",source:"@site/docs/drm.md",sourceDirName:".",slug:"/drm",permalink:"/drm",tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"Browser Issues",permalink:"/browser-issues"},next:{title:"Charles Proxy and HAR Files",permalink:"/charles-and-har-files"}},p=[{value:"Quick intro to EME in web players",id:"quick-intro-to-eme-in-web-players",children:[],level:2},{value:"No playback (audio or video)",id:"no-playback-audio-or-video",children:[],level:2},{value:"Playback of audio but no video",id:"playback-of-audio-but-no-video",children:[],level:2},{value:"Playback stops",id:"playback-stops",children:[{value:"After a few seconds",id:"after-a-few-seconds",children:[],level:3},{value:"After more than a few seconds",id:"after-more-than-a-few-seconds",children:[{value:"Key rotation",id:"key-rotation",children:[],level:4},{value:"Unencrypted content to encrypted",id:"unencrypted-content-to-encrypted",children:[],level:4}],level:3}],level:2},{value:"Creating test DRM content",id:"creating-test-drm-content",children:[],level:2}],d={toc:p};function u(e){var t=e.components,n=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"drm"},"DRM"),(0,a.kt)("p",null,"Now it's time for everyone's favorite topic, digital rights management."),(0,a.kt)("p",null,"DRM for web video is handled through the ",(0,a.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/encrypted-media/"},"EME (encrypted media extensions) API"),"."),(0,a.kt)("p",null,"The purpose of DRM is to make debugging difficult (this is only partially true). That said, there do exist some tools and strategies you can use to help diagnose some common issues."),(0,a.kt)("p",null,"Most DRM-related problems can be broken down into one of three categories:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"No playback (audio or video)")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Playback of audio but no video")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Playback stops"))),(0,a.kt)("h2",{id:"quick-intro-to-eme-in-web-players"},"Quick intro to EME in web players"),(0,a.kt)("p",null,"EME provides the APIs needed to allow a browser to decrypt encrypted video. But to do that, it needs to be properly configured. If you're using a custom player, they generally have easy options (or plugins with options) to configure EME, so all you need is to:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"List the different key systems that the content supports (e.g., Widevine and PlayReady)"),(0,a.kt)("li",{parentName:"ol"},"For each key system, provide a license URL for retrieving a key")),(0,a.kt)("p",null,"The license is provided to the browser, which, under the surface, uses it with a CDM (content decryption module) to decrypt the content."),(0,a.kt)("h2",{id:"no-playback-audio-or-video"},"No playback (audio or video)"),(0,a.kt)("p",null,"The most common issue you'll run into is no playback."),(0,a.kt)("p",null,"Often it's because the key system options are not provided to the player, or are not provided in a way the player expects. If the player uses a plugin for handling DRM/EME, then verify that the plugin is included, and that it's initialized."),(0,a.kt)("p",null,"Certain key systems only work on certain browsers, so make sure that the key system you're trying to use is supported."),(0,a.kt)("p",null,"If you know that the options are configured correctly, and you're dealing with content that is encrypted with multiple key systems (e.g., Widevine and PlayReady), then try one of the other key systems (you may need to use a different browser)."),(0,a.kt)("p",null,"Check the ",(0,a.kt)("a",{parentName:"p",href:"devtools-network"},"devtools network panel")," to see if any license requests failed. Check also that license requests were made. If no license requests were made, then either the EME options aren't provided correctly to the player, the EME plugin/system is not initialized, the content is not encrypted, or something failed before a key session requested a license."),(0,a.kt)("p",null,"Some manifests internally signal their encryption and necessary decryption information. Check for DASH's ",(0,a.kt)("inlineCode",{parentName:"p"},"ContentProtection")," elements and HLS's ",(0,a.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-10#section-4.4.4.4"},"EXT-X-KEY tags"),"."),(0,a.kt)("p",null,"One way to check if the content is encrypted is to hook into the EME events on the video element. For browsers using the modern EME API, check for the ",(0,a.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/encrypted-media/#dom-htmlmediaelement-onencrypted"},"encrypted")," event. Other EME events may be triggered on session objects created as part of the ",(0,a.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/encrypted-media/#examples"},"EME workflow"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// Here we're assuming there's one video element on the page, but\n// it would be better to use the specific player you want in place\n// of this assumption.\nconst videoElement = document.getElementsByTagName('video')[0];\n\nvideoElement.addEventListener('encrypted', () => console.log('\"encrypted\" event fired'));\n")),(0,a.kt)("h2",{id:"playback-of-audio-but-no-video"},"Playback of audio but no video"),(0,a.kt)("p",null,"If only audio plays back, a common issue is that the content is encrypted such that it's not allowed to be played on external monitors (or only on specific external monitors). See also ",(0,a.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/High-bandwidth_Digital_Content_Protection"},"HDCP"),"."),(0,a.kt)("h2",{id:"playback-stops"},"Playback stops"),(0,a.kt)("h3",{id:"after-a-few-seconds"},"After a few seconds"),(0,a.kt)("p",null,"It's possible for some encrypted content to play the first few seconds before stopping when no license is provided. In this case, verify that the license is successfully retrieved and working (see the section on ",(0,a.kt)("a",{parentName:"p",href:"#no-playback-audio-or-video"},"no playback")," above)."),(0,a.kt)("h3",{id:"after-more-than-a-few-seconds"},"After more than a few seconds"),(0,a.kt)("h4",{id:"key-rotation"},"Key rotation"),(0,a.kt)("p",null,"Generally, if a key expires, the player and EME implementation should handle retrieving a new usable key from the given license server (provided via the key system options). If there's an issue with the server's response, or if the player is not requesting a new key, verify that the ",(0,a.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/encrypted-media/#dom-htmlmediaelement-onwaitingforkey"},"waitingforkey")," event is fired, and that a new license request is made in the ",(0,a.kt)("a",{parentName:"p",href:"devtools-network"},"devtools network panel"),"."),(0,a.kt)("p",null,"To listen for the ",(0,a.kt)("inlineCode",{parentName:"p"},"waitingforkey")," event:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// Here we're assuming there's one video element on the page, but\n// it would be better to use the specific player you want in place\n// of this assumption.\nconst videoElement = document.getElementsByTagName('video')[0];\n\nvideoElement.addEventListener('waitingforkey', () => console.log('\"waitingforkey\" event fired'));\n")),(0,a.kt)("h4",{id:"unencrypted-content-to-encrypted"},"Unencrypted content to encrypted"),(0,a.kt)("p",null,"Some browsers require EME to be configured at the start of video playback, even if the video starts with content that is unencrypted (e.g., playing an unencrypted ad before encrypted content). If EME is not configured, when the player reaches the encrypted content, the browser may throw an error."),(0,a.kt)("p",null,"To resolve this issue, make sure that the key session in being created at the start of playback, before any content is appended."),(0,a.kt)("h2",{id:"creating-test-drm-content"},"Creating test DRM content"),(0,a.kt)("p",null,"Without proper credentials for various key systems, it's nearly impossible to create test content. However, there is one key system that must be supported by all browsers and is easier to create content for, ",(0,a.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/encrypted-media/#clear-key"},"Clear Key"),"."),(0,a.kt)("p",null,"One great tool for creating test content using Clear Key is ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/google/shaka-packager"},"Shaka Packager"),". For a script that wraps Shaka Packager with a shortened list of options, there's ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/gesinger/encrypted-video-creator"},"encrypted video creator"),"."))}u.isMDXComponent=!0}}]);