<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">DRM | Debug Video</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://debugvideo.com/drm"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="DRM | Debug Video"><meta data-react-helmet="true" name="description" content="Now it&#x27;s time for everyone&#x27;s favorite topic, digital rights management."><meta data-react-helmet="true" property="og:description" content="Now it&#x27;s time for everyone&#x27;s favorite topic, digital rights management."><link data-react-helmet="true" rel="icon" href="/img/logo.svg"><link data-react-helmet="true" rel="canonical" href="https://debugvideo.com/drm"><link data-react-helmet="true" rel="alternate" href="https://debugvideo.com/drm" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://debugvideo.com/drm" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.488c9a18.css">
<link rel="preload" href="/assets/js/runtime~main.749a3c58.js" as="script">
<link rel="preload" href="/assets/js/main.5ce7ed76.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Debug Video Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.svg" alt="Debug Video Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Debug Video</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/gesinger/debug-video" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">What is this?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/who-is-this-for">Who is this for?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/what-will-i-be-able-to-do">What will I be able to do?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/how-is-this-guide-organized">How is this guide organized?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/short-guide-streaming-video">A short guide to streaming video</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/addressing-new-tickets">Addressing new tickets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/what-if-you-cant-reproduce">What if you can&#x27;t reproduce?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_TwRn" href="/browser-devtools">Browser developer tools</a><button aria-label="Toggle the collapsible sidebar category &#x27;Browser developer tools&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/devtools-console">Console</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/devtools-network">Network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/devtools-media">Media</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_TwRn" href="/stream-issues">Stream issues</a><button aria-label="Toggle the collapsible sidebar category &#x27;Stream issues&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manifest-issues">Manifest</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/segment-issues">Segment</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/player-issues">Player issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/browser-issues">Browser issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/drm">DRM</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/charles-and-har-files">Other tools</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/charles-and-har-files">Charles Proxy and HAR files</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/exercises">Exercises</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>DRM</h1></header><p>Now it&#x27;s time for everyone&#x27;s favorite topic, digital rights management.</p><p>DRM for web video is handled through the <a href="https://www.w3.org/TR/encrypted-media/" target="_blank" rel="noopener noreferrer">EME (encrypted media extensions) API</a>.</p><p>The purpose of DRM is to make debugging difficult (this is only partially true). That said, there do exist some tools and strategies you can use to help diagnose some common issues.</p><p>Most DRM-related problems can be broken down into one of three categories:</p><ul><li><strong>No playback (audio or video)</strong></li><li><strong>Playback of audio but no video</strong></li><li><strong>Playback stops</strong></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="quick-intro-to-eme-in-web-players">Quick intro to EME in web players<a class="hash-link" href="#quick-intro-to-eme-in-web-players" title="Direct link to heading">â€‹</a></h2><p>EME provides the APIs needed to allow a browser to decrypt encrypted video. But to do that, it needs to be properly configured. If you&#x27;re using a custom player, they generally have easy options (or plugins with options) to configure EME, so all you need is to:</p><ol><li>List the different key systems that the content supports (e.g., Widevine and PlayReady)</li><li>For each key system, provide a license URL for retrieving a key</li></ol><p>The license is provided to the browser, which, under the surface, uses it with a CDM (content decryption module) to decrypt the content.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="no-playback-audio-or-video">No playback (audio or video)<a class="hash-link" href="#no-playback-audio-or-video" title="Direct link to heading">â€‹</a></h2><p>The most common issue you&#x27;ll run into is no playback.</p><p>Often it&#x27;s because the key system options are not provided to the player, or are not provided in a way the player expects. If the player uses a plugin for handling DRM/EME, then verify that the plugin is included, and that it&#x27;s initialized.</p><p>Certain key systems only work on certain browsers, so make sure that the key system you&#x27;re trying to use is supported.</p><p>If you know that the options are configured correctly, and you&#x27;re dealing with content that is encrypted with multiple key systems (e.g., Widevine and PlayReady), then try one of the other key systems (you may need to use a different browser).</p><p>Check the <a href="/devtools-network">devtools network panel</a> to see if any license requests failed. Check also that license requests were made. If no license requests were made, then either the EME options aren&#x27;t provided correctly to the player, the EME plugin/system is not initialized, the content is not encrypted, or something failed before a key session requested a license.</p><p>Some manifests internally signal their encryption and necessary decryption information. Check for DASH&#x27;s <code>ContentProtection</code> elements and HLS&#x27;s <a href="https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-10#section-4.4.4.4" target="_blank" rel="noopener noreferrer">EXT-X-KEY tags</a>.</p><p>One way to check if the content is encrypted is to hook into the EME events on the video element. For browsers using the modern EME API, check for the <a href="https://www.w3.org/TR/encrypted-media/#dom-htmlmediaelement-onencrypted" target="_blank" rel="noopener noreferrer">encrypted</a> event. Other EME events may be triggered on session objects created as part of the <a href="https://www.w3.org/TR/encrypted-media/#examples" target="_blank" rel="noopener noreferrer">EME workflow</a>.</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Here we&#x27;re assuming there&#x27;s one video element on the page, but</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// it would be better to use the specific player you want in place</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// of this assumption.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> videoElement </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementsByTagName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;video&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">videoElement</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;encrypted&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;&quot;encrypted&quot; event fired&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="playback-of-audio-but-no-video">Playback of audio but no video<a class="hash-link" href="#playback-of-audio-but-no-video" title="Direct link to heading">â€‹</a></h2><p>If only audio plays back, a common issue is that the content is encrypted such that it&#x27;s not allowed to be played on external monitors (or only on specific external monitors). See also <a href="https://en.wikipedia.org/wiki/High-bandwidth_Digital_Content_Protection" target="_blank" rel="noopener noreferrer">HDCP</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="playback-stops">Playback stops<a class="hash-link" href="#playback-stops" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="after-a-few-seconds">After a few seconds<a class="hash-link" href="#after-a-few-seconds" title="Direct link to heading">â€‹</a></h3><p>It&#x27;s possible for some encrypted content to play the first few seconds before stopping when no license is provided. In this case, verify that the license is successfully retrieved and working (see the section on <a href="#no-playback-audio-or-video">no playback</a> above).</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="after-more-than-a-few-seconds">After more than a few seconds<a class="hash-link" href="#after-more-than-a-few-seconds" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="key-rotation">Key rotation<a class="hash-link" href="#key-rotation" title="Direct link to heading">â€‹</a></h4><p>Generally, if a key expires, the player and EME implementation should handle retrieving a new usable key from the given license server (provided via the key system options). If there&#x27;s an issue with the server&#x27;s response, or if the player is not requesting a new key, verify that the <a href="https://www.w3.org/TR/encrypted-media/#dom-htmlmediaelement-onwaitingforkey" target="_blank" rel="noopener noreferrer">waitingforkey</a> event is fired, and that a new license request is made in the <a href="/devtools-network">devtools network panel</a>.</p><p>To listen for the <code>waitingforkey</code> event:</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Here we&#x27;re assuming there&#x27;s one video element on the page, but</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// it would be better to use the specific player you want in place</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// of this assumption.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> videoElement </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementsByTagName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;video&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">videoElement</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;waitingforkey&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;&quot;waitingforkey&quot; event fired&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="unencrypted-content-to-encrypted">Unencrypted content to encrypted<a class="hash-link" href="#unencrypted-content-to-encrypted" title="Direct link to heading">â€‹</a></h4><p>Some browsers require EME to be configured at the start of video playback, even if the video starts with content that is unencrypted (e.g., playing an unencrypted ad before encrypted content). If EME is not configured, when the player reaches the encrypted content, the browser may throw an error.</p><p>To resolve this issue, make sure that the key session in being created at the start of playback, before any content is appended.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="creating-test-drm-content">Creating test DRM content<a class="hash-link" href="#creating-test-drm-content" title="Direct link to heading">â€‹</a></h2><p>Without proper credentials for various key systems, it&#x27;s nearly impossible to create test content. However, there is one key system that must be supported by all browsers and is easier to create content for, <a href="https://www.w3.org/TR/encrypted-media/#clear-key" target="_blank" rel="noopener noreferrer">Clear Key</a>.</p><p>One great tool for creating test content using Clear Key is <a href="https://github.com/google/shaka-packager" target="_blank" rel="noopener noreferrer">Shaka Packager</a>. For a script that wraps Shaka Packager with a shortened list of options, there&#x27;s <a href="https://github.com/gesinger/encrypted-video-creator" target="_blank" rel="noopener noreferrer">encrypted video creator</a>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/browser-issues"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Browser Issues</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/charles-and-har-files"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Charles Proxy and HAR Files</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#quick-intro-to-eme-in-web-players" class="table-of-contents__link toc-highlight">Quick intro to EME in web players</a></li><li><a href="#no-playback-audio-or-video" class="table-of-contents__link toc-highlight">No playback (audio or video)</a></li><li><a href="#playback-of-audio-but-no-video" class="table-of-contents__link toc-highlight">Playback of audio but no video</a></li><li><a href="#playback-stops" class="table-of-contents__link toc-highlight">Playback stops</a><ul><li><a href="#after-a-few-seconds" class="table-of-contents__link toc-highlight">After a few seconds</a></li><li><a href="#after-more-than-a-few-seconds" class="table-of-contents__link toc-highlight">After more than a few seconds</a></li></ul></li><li><a href="#creating-test-drm-content" class="table-of-contents__link toc-highlight">Creating test DRM content</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.749a3c58.js"></script>
<script src="/assets/js/main.5ce7ed76.js"></script>
</body>
</html>